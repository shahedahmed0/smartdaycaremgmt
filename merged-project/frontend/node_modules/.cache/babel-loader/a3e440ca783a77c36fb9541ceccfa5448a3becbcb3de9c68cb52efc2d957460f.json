{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import axios from'axios';import'./ChatButton.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChatButton=_ref=>{let{userId,userRole='parent'}=_ref;const[unreadCount,setUnreadCount]=useState(0);const[isOnline,setIsOnline]=useState(true);useEffect(()=>{fetchUnreadCount();// Poll for new messages every 30 seconds\nconst interval=setInterval(fetchUnreadCount,30000);return()=>clearInterval(interval);},[userId]);const fetchUnreadCount=async()=>{try{const response=await axios.get(\"http://localhost:5000/api/chats/user/\".concat(userId));if(response.data.success){const totalUnread=response.data.data.chats.reduce((sum,chat)=>sum+(chat.unreadCount||0),0);setUnreadCount(totalUnread);}}catch(error){console.error('Error fetching unread count:',error);}};return/*#__PURE__*/_jsx(Link,{to:\"/chat\",className:\"chat-button-link\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat-button-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-button\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat-icon\",children:\"\\uD83D\\uDCAC\"}),unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:\"chat-badge\",children:unreadCount}),isOnline&&/*#__PURE__*/_jsx(\"span\",{className:\"online-indicator\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-tooltip\",children:[\"Chat with \",userRole==='parent'?'Staff':'Parents',unreadCount>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"tooltip-count\",children:[\"(\",unreadCount,\" new)\"]})]})]})});};export default ChatButton;","map":{"version":3,"names":["React","useState","useEffect","Link","axios","jsx","_jsx","jsxs","_jsxs","ChatButton","_ref","userId","userRole","unreadCount","setUnreadCount","isOnline","setIsOnline","fetchUnreadCount","interval","setInterval","clearInterval","response","get","concat","data","success","totalUnread","chats","reduce","sum","chat","error","console","to","className","children"],"sources":["/media/dh77b/New Volume/smartdaycare/merged-project/frontend/src/components/ChatButton/ChatButton.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport axios from 'axios';\nimport './ChatButton.css';\n\nconst ChatButton = ({ userId, userRole = 'parent' }) => {\n    const [unreadCount, setUnreadCount] = useState(0);\n    const [isOnline, setIsOnline] = useState(true);\n\n    useEffect(() => {\n        fetchUnreadCount();\n        \n        // Poll for new messages every 30 seconds\n        const interval = setInterval(fetchUnreadCount, 30000);\n        \n        return () => clearInterval(interval);\n    }, [userId]);\n\n    const fetchUnreadCount = async () => {\n        try {\n            const response = await axios.get(`http://localhost:5000/api/chats/user/${userId}`);\n            \n            if (response.data.success) {\n                const totalUnread = response.data.data.chats.reduce((sum, chat) => \n                    sum + (chat.unreadCount || 0), 0\n                );\n                setUnreadCount(totalUnread);\n            }\n        } catch (error) {\n            console.error('Error fetching unread count:', error);\n        }\n    };\n\n    return (\n        <Link to=\"/chat\" className=\"chat-button-link\">\n            <div className=\"chat-button-container\">\n                <div className=\"chat-button\">\n                    <span className=\"chat-icon\">ðŸ’¬</span>\n                    {unreadCount > 0 && (\n                        <span className=\"chat-badge\">{unreadCount}</span>\n                    )}\n                    {isOnline && (\n                        <span className=\"online-indicator\"></span>\n                    )}\n                </div>\n                <div className=\"chat-tooltip\">\n                    Chat with {userRole === 'parent' ? 'Staff' : 'Parents'}\n                    {unreadCount > 0 && (\n                        <span className=\"tooltip-count\">({unreadCount} new)</span>\n                    )}\n                </div>\n            </div>\n        </Link>\n    );\n};\n\nexport default ChatButton;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,IAAI,KAAQ,kBAAkB,CACvC,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE1B,KAAM,CAAAC,UAAU,CAAGC,IAAA,EAAqC,IAApC,CAAEC,MAAM,CAAEC,QAAQ,CAAG,QAAS,CAAC,CAAAF,IAAA,CAC/C,KAAM,CAACG,WAAW,CAAEC,cAAc,CAAC,CAAGb,QAAQ,CAAC,CAAC,CAAC,CACjD,KAAM,CAACc,QAAQ,CAAEC,WAAW,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CAE9CC,SAAS,CAAC,IAAM,CACZe,gBAAgB,CAAC,CAAC,CAElB;AACA,KAAM,CAAAC,QAAQ,CAAGC,WAAW,CAACF,gBAAgB,CAAE,KAAK,CAAC,CAErD,MAAO,IAAMG,aAAa,CAACF,QAAQ,CAAC,CACxC,CAAC,CAAE,CAACP,MAAM,CAAC,CAAC,CAEZ,KAAM,CAAAM,gBAAgB,CAAG,KAAAA,CAAA,GAAY,CACjC,GAAI,CACA,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAAjB,KAAK,CAACkB,GAAG,yCAAAC,MAAA,CAAyCZ,MAAM,CAAE,CAAC,CAElF,GAAIU,QAAQ,CAACG,IAAI,CAACC,OAAO,CAAE,CACvB,KAAM,CAAAC,WAAW,CAAGL,QAAQ,CAACG,IAAI,CAACA,IAAI,CAACG,KAAK,CAACC,MAAM,CAAC,CAACC,GAAG,CAAEC,IAAI,GAC1DD,GAAG,EAAIC,IAAI,CAACjB,WAAW,EAAI,CAAC,CAAC,CAAE,CACnC,CAAC,CACDC,cAAc,CAACY,WAAW,CAAC,CAC/B,CACJ,CAAE,MAAOK,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CACxD,CACJ,CAAC,CAED,mBACIzB,IAAA,CAACH,IAAI,EAAC8B,EAAE,CAAC,OAAO,CAACC,SAAS,CAAC,kBAAkB,CAAAC,QAAA,cACzC3B,KAAA,QAAK0B,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eAClC3B,KAAA,QAAK0B,SAAS,CAAC,aAAa,CAAAC,QAAA,eACxB7B,IAAA,SAAM4B,SAAS,CAAC,WAAW,CAAAC,QAAA,CAAC,cAAE,CAAM,CAAC,CACpCtB,WAAW,CAAG,CAAC,eACZP,IAAA,SAAM4B,SAAS,CAAC,YAAY,CAAAC,QAAA,CAAEtB,WAAW,CAAO,CACnD,CACAE,QAAQ,eACLT,IAAA,SAAM4B,SAAS,CAAC,kBAAkB,CAAO,CAC5C,EACA,CAAC,cACN1B,KAAA,QAAK0B,SAAS,CAAC,cAAc,CAAAC,QAAA,EAAC,YAChB,CAACvB,QAAQ,GAAK,QAAQ,CAAG,OAAO,CAAG,SAAS,CACrDC,WAAW,CAAG,CAAC,eACZL,KAAA,SAAM0B,SAAS,CAAC,eAAe,CAAAC,QAAA,EAAC,GAAC,CAACtB,WAAW,CAAC,OAAK,EAAM,CAC5D,EACA,CAAC,EACL,CAAC,CACJ,CAAC,CAEf,CAAC,CAED,cAAe,CAAAJ,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}